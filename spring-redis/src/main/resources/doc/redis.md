# Redis

## Redis常见问题

链接：[https://mp.weixin.qq.com/s/KEGIeYkPiGx_gbcWdFIGLw]

1. Redis的持久化机制

RDB方式：Redis的默认持久化方式，按照一定的时间周期策略把内存的数据以快照的形式保存到硬盘的二进制文件，即Snapshot快照存储，
对应产生的数据文件为dump.rdb文件，可通过配置文件中的save参数定义快照的周期（快照可以是其所表示数据的一个压缩过的副本）

AOF方式：Redis会将每一个收到的写命令都通过Write函数追加到append文件的末尾，类似于MySQL的binlog文件，当Redis重启之后，
会通过重新执行append文件中保存的写命令来在内存中重建所有数据

两种方式同时开启时，数据恢复时Redis会优先选择AOF恢复

2. 缓存雪崩、缓存穿透、缓存预热、缓存更新、缓存降级

缓存雪崩：同一时刻，大量缓存失效，导致大量请求直接访问数据库，数据库压力突增
解决方式：设置缓存失效时间且时间分散设置，或者使用加锁或队列的方式保证不会有大量线程同时访问数据库

缓存穿透：用户查询数据，在数据库没有，缓存中也没有，这样就会存在用户查询时，先查一遍缓存，再查一遍数据库，然后返回空
解决方式：bitmap和布隆过滤器，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被拦截掉，从而避免了对
底层存储系统的查询压力

缓存击穿：指一个热点数据，大并发对其访问，当热点缓存失效时，持续的大并发会直接请求数据库
解决方式：访问缓存时，使用SETNX来设置另一个短期Key锁住当前的访问，访问结束再删除短期Key（Redis版本的分布式锁）

缓存预热：系统启动时，直接将相关数据添加到缓存中
解决方式：实现一个缓存刷新接口，系统启动时手动调用，或者通过定时任务刷新

缓存更新：可以根据需求进行自定义的缓存淘汰，常见策略有定时请求缓存和判断缓存过期时间

3. 热点数据和冷数据

热点数据：访问率高的数据
冷数据：访问频率低

4. Memcache和Redis的区别

1） 存储方式，Memcache全部存在内存之中，机器宕机则会丢失所有数据，Redis可持久化数据
2） 数据类型支持，Memcache只支持字符串，Redis支持多种数据类型，如字符串、list、set、zset、hash等
3） 使用底层模型不同，底层实现方式以及与客户端之间的通信协议不一样，Redis构建了自己的VM机制
4） value值允许的大小不一样，Redis最大可达512M，Memcache只有1MB
5） Redis的速度相比Memcache快很多
6） Redis支持数据备份，即master-slave模式的数据备份

5. 单线程的Redis为什么这么快

1） 内存操作
2） 单线程，避免上下文的切换
3） 采用非阻塞I/O多路复用机制